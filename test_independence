test_independence <- function(df, x, y, alpha = 0.05) { #df = data frame, x = predictor, y = pathogen

    #cross tabulation
    tab <- table(df[, x], df[, y])
    print(tab)
    total_cells <- nrow(tab) * ncol(tab)

    #Chi-sq test
    cst <- chisq.test(tab, correct = FALSE)
    expected_counts <- cst$expected 
  cells_gte_five <- sum (expected_counts >= 5)

  # if the assumptions of the chi squared test are violated...
  if (((cells_gte_five / total_cells) < 0.8) || any(expected_counts < 1)) {
        #Fisher test
       fet <- fisher.test(tab)
    test1 <- "fisher_test" 
    print(test1)
    print(fet)

         # if statistically significant...
    if (fet$p.value < alpha) {
      epitools::oddsratio(x=tab, method="wald") %>%
        print()    }

    # ... otherwise do this...
  } else {
         test2 <- "chisq test"
     print(test2)
     print(cst)

        # if statistically significant...
    if (cst$p.value < alpha) {
      epitools::oddsratio(x=tab, method="wald") %>%
        print()
    }    
  }
}
